<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    namespace：必须与对应的接口全类名一致  UserMapper.java
    id ：必须与对应接口的某个对应的方法名一致即必须要和UserMapper.java接口中的方法同名。
 -->
<mapper namespace="com.zafu.nichang.mapper.ProductMapper">

    <insert id="insertProduct" parameterType="java.util.List" useGeneratedKeys="false">
        insert into product_everyday_detail(product_name,min_price,avg_price,max_price,size_type,unit,date_time,product_type,insert_time,update_time)
        values
        <foreach collection="list" item="item" index="index" separator=",">
            (
                #{item.productName},
                #{item.minPrice},
                #{item.avgPrice},
                #{item.maxPrice},
                #{item.sizeType},
                #{item.unit},
                #{item.dateTime},
                #{item.productType},
                NOW(),
                NOW()
            )
        </foreach>
    </insert>

    <insert id="saveProduct">
        insert into product_everyday_detail(product_name,min_price,avg_price,max_price,size_type,unit,date_time,product_type,insert_time,update_time)
        values
            (
            #{productName},
            #{minPrice},
            #{avgPrice},
            #{maxPrice},
            #{sizeType},
            #{unit},
            #{dateTime},
            #{productType},
            NOW(),
            NOW()
            )
    </insert>

    <select id="selectProduct" resultType="Product">
        select product_name, min_price, avg_price, max_price,size_type, unit, substr(date_time,1,10) as date_time, product_type
        from product_everyday_detail
        <where>
            <if test="productType != null and productType != ''">
                product_type = #{productType, jdbcType=VARCHAR}
            </if>
            <if test="productName != null and productName != ''">
                and product_name = #{productName, jdbcType=VARCHAR}
            </if>
            <if test="sizeType != null and sizeType != ''">
                and size_type = #{sizeType, jdbcType=VARCHAR}
            </if>
            <if test="startTime != null and startTime != ''">
                and date_time <![CDATA[>=]]> #{startTime, jdbcType=VARCHAR}
            </if>
            <if test="endTime != null and endTime != ''">
                and date_time <![CDATA[<=]]> #{endTime, jdbcType=VARCHAR}
            </if>
        </where>
    </select>

    <select id="selectTransportMessage" resultType="TransportProduct">
        select type, province, percent
        from product_province_percent
    </select>

    <select id="selectTotalData" resultType="TransportProduct">
        select product_type as type, total_kg
        from product_total_kg
    </select>

    <select id="getAnalysisProduct" resultType="Product">
        select *
        from product_everyday_detail
        <where>
            <if test="productName != null and productName != ''">
                product_name = #{productName, jdbcType=VARCHAR}
            </if>
            <if test="sizeType != null and sizeType != ''">
                and size_type = #{sizeType, jdbcType=VARCHAR}
            </if>
            <if test="productName != null and productName != ''and sizeType != null and sizeType != ''">
                and DATE_SUB(CURDATE(), INTERVAL 30 DAY) <![CDATA[<=]]> date(date_time) order by date_time
            </if>
        </where>
    </select>

    <select id="getMaxDateFromTable" resultType="Product">
        select product_type, substr(MAX(date_time),1,10) as date_time
        from product_everyday_detail
		group by product_type
    </select>

    <select id="getSizeFromTable" resultType="int">
        select count(id) as count_number
        from product_everyday_detail
    </select>
</mapper>